<!-- index.html -->
{% extends 'layout.html' %}
{% block title %}Billing System{% endblock %}
{% block content %}
<section>
    <h2>Create a New Bill</h2>
    <form id="bill-form" action="{{ url_for('create_bill') }}" method="post">
        <div class="form-group">
            <label for="item_name">Item Name:</label>
            <input type="text" id="item_name" name="item_name" class="form-control" autocomplete="off" oninput="getSuggestions(this.value)">
            <div id="suggestions"></div>
        </div>
        <div class="form-group">
            <label for="quantity">Quantity:</label>
            <input type="number" id="quantity" name="quantity" class="form-control" min="1" value="1">
        </div>
        <button type="button" onclick="addItemToBill()" class="btn btn-primary">Add Item</button>
    </form>
    <hr>
    <h2>Current Bill</h2>
    <table class="table">
        <thead>
            <tr>
                <th>Item Name</th>
                <th>Quantity</th>
                <th>Price</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="bill_items">
            <!-- This will be populated dynamically with JavaScript -->
        </tbody>
    </table>
    <div id="total">Total: $0</div>
    <button onclick="submitBill()" class="btn btn-success">Submit Bill</button>
</section>
<script>
   function getSuggestions(keyword) {
        // Clear previous suggestions
        document.getElementById('suggestions').innerHTML = '';
        // Make AJAX request to fetch suggestions
        fetch(`/get_suggestions?keyword=${keyword}`)
            .then(response => response.json())
            .then(data => {
                // Populate suggestions div with the received suggestions
                data.forEach(suggestion => {
                    const suggestionElement = document.createElement('div');
                    suggestionElement.textContent = suggestion;
                    suggestionElement.onclick = () => {
                        // Set the clicked suggestion as the input value
                        document.getElementById('item_name').value = suggestion;
                        // Clear suggestions
                        document.getElementById('suggestions').innerHTML = '';
                    };
                    document.getElementById('suggestions').appendChild(suggestionElement);
                });
            })
            .catch(error => console.error('Error fetching suggestions:', error));
    }

    function addItemToBill() {
    // Get the selected item's name and quantity
    var itemName = document.getElementById('item_name').value;
    var itemQuantity = parseInt(document.getElementById('quantity').value);
    
    // Make AJAX request to fetch the price for the selected item
    fetch(`/get_item_price?item_name=${itemName}`)
        .then(response => response.json())
        .then(data => {
            var itemPrice = data.price; // Assuming the server returns the price in the response
            if (itemPrice) {
                // Create a new row for the bill table
                var table = document.getElementById('bill_items');
                var newRow = table.insertRow();
                
                // Insert cells for item name, quantity, price, and delete option
                var cellName = newRow.insertCell(0);
                var cellQuantity = newRow.insertCell(1);
                var cellPrice = newRow.insertCell(2);
                var cellDelete = newRow.insertCell(3);
                
                // Populate cells with item details
                cellName.innerHTML = itemName;
                cellQuantity.innerHTML = itemQuantity;
                cellPrice.innerHTML = itemPrice;
                
                // Create delete button and attach event listener
                var deleteButton = document.createElement('button');
                deleteButton.innerHTML = 'Delete';
                deleteButton.onclick = function() {
                    table.deleteRow(newRow.rowIndex);
                    // Optionally, update total amount in the bill after deletion
                };
                cellDelete.appendChild(deleteButton);
                
                // Update total amount in the bill (if needed)
                // For example:
                // updateTotalAmount(itemQuantity * itemPrice);
            } else {
                console.error('Price not found for the selected item.');
            }
        })
        .catch(error => console.error('Error fetching item price:', error));
}
    function deleteItemFromBill(itemId) {
        // Code to delete an item from the bill and update the table
    }

    function submitBill() {
        // Code to submit the bill to the server
    }
</script>
{% endblock %}
